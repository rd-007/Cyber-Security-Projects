"""Typer CLI for subnet scan."""
import typer
from rich import print, box
from rich.table import Table
from scannerlib import network_scan, match_cves

app = typer.Typer(add_completion=False, help="IoT Vulnerability Scanner CLI")


@app.command()
def scan(subnet: str):
    """Scan subnet (e.g., 192.168.1.0/24) and print a table."""
    devices = network_scan(subnet)
    table = Table(title=f"Scan results for {subnet}", box=box.MINIMAL_DOUBLE_HEAD)
    table.add_column("IP")
    table.add_column("Vendor")
    table.add_column("Open Ports")
    table.add_column("CVE Count")

    for d in devices:
        cves = match_cves(d)
        table.add_row(
            d.ip,
            d.vendor or "-",
            ",".join(str(p.port) for p in d.ports if p.state == "open") or "-",
            str(len(cves)),
        )
    print(table)


if __name__ == "__main__":
    app()
